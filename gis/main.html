<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <title>Leaflet OSM</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
        <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%;height:95%; }
        #info {
            display: block;
            position: relative;
            margin: 0px auto;

            width: 50%;
            padding: 10px;
            border: none;
            border-radius: 3px;
            font-size: 12px;
            text-align: center;
            color: #222;
            background: #fff;
        }
    </style>
</head>
<body>
<!-- jQuery is required for this example. -->
<script src='jquery.js'></script>
<script src='mapbox.js'></script>
<script src='layer.js'></script>

<link href='mapbx.css' rel='stylesheet' />
<script src='leaflet-osm.js'></script>

<!--<script src="https://cdn.bootcss.com/mapbox-gl/0.50.0/mapbox-gl.js"></script>-->
<!--<link href="https://cdn.bootcss.com/mapbox-gl/0.50.0/mapbox-gl.css" rel="stylesheet">-->
<div id='map'></div>

<pre id='info'></pre>
<div style="position: absolute;bottom: 0">
    <button onclick="mypoint()" value="选取两点">选取两点</button>
    <button onclick="myzhuang()" value="均分打桩">均分打桩</button>
    <button onclick="myline()"  value="公路连线">公路连线</button>
    <button onclick="mycircle()" value="曲率半径">曲率半径</button>
</div>
<script>
    function mypoint() {
        try {
            pointGroup.clearLayers();
        }
        catch(e) {
        }
        $.ajax({
            url:"point.xml",
            dataType: "xml",
            success: function (xml) {
                var marks=[];

                var xml_data= new L.OSM.DataLayer(xml);
                var layers =xml_data.getLayers();
                layers.forEach(function (item,index) {
                    console.log(item.getLatLng());
                    var marker = L.marker(item.getLatLng(), {
                        icon: L.mapbox.marker.icon({
                            'marker-color': 'ff8888'
                        }),
                        draggable: true
                    });
                    marker.addTo(map);
                    marks.push(marker);

                });
                pointGroup=L.layerGroup(marks);
                map.addLayer(pointGroup);
                map.fitBounds(xml_data.getBounds());
            }
        });

    }
    function myline() {
        pointGroup.clearLayers();
        $.ajax({
            url:"line.xml",
            dataType: "xml",

            success: function (xml) {
                var xml_data= new L.OSM.DataLayer(xml).addTo(map);
                map.fitBounds(xml_data.getBounds());

            }
        });
    }
    function mycircle() {
        pointGroup.clearLayers();
        $.ajax({
            url:"line_circle.xml",
            dataType: "xml",
            success: function (xml) {
                var marks=[];

                var xml_data= new L.OSM.DataLayer(xml).addTo(map);
                var marker = L.marker([39.85574547899,116.32564066635133], {
                    icon: L.mapbox.marker.icon({
                        'marker-color': 'ff8888'
                    }),
                    draggable: true

                });
                marks.push(marker);
                marker.addTo(map);
                pointGroup=L.layerGroup(marks);
                map.addLayer(pointGroup);
                map.fitBounds(xml_data.getBounds());
                alert( '半径为985.2145387米');

            }
        });
    }
    function myzhuang() {
        pointGroup.clearLayers();
        $.ajax({
            url:"zhuang.xml",
            dataType: "xml",
            success: function (xml) {
                var xml_data= new L.OSM.DataLayer(xml);
                var layers =xml_data.getLayers();
                var marks=[];
                layers.forEach(function (item,index) {
                    console.log(item.getLatLng());
                    var marker = L.marker(item.getLatLng(), {
                        icon: L.mapbox.marker.icon({
                            'marker-color': 'ff8888'
                        }),
                        draggable: true
                    });
                    marker.bindPopup('<button onclick="opentable('+item.getLatLng().lat+","+item.getLatLng().lng+')" >添加标志物</button>');
                    marker.addTo(map);
                    marks.push(marker);
                });
                pointGroup=L.layerGroup(marks);
                map.addLayer(pointGroup);
                map.fitBounds(xml_data.getBounds());
            }
        });
    }
</script>
<script>
    function opentable(lat,lng) {
        layer.open({
            type: 2,
            area: ['800px', '600px'],
            title:'标志物经度'+lat+'纬度'+lng,
            fixed: false, //不固定
            maxmin: true,
            shadeClose: true, //点击遮罩关闭

            content: 'table.html'
        });
    }

</script>
<script>
    function getxml(str) {
         var parser=new DOMParser();
        return parser.parseFromString(str,"text/xml");
    }

    L.mapbox.accessToken = 'pk.eyJ1Ijoid3NjanhreSIsImEiOiJjam9xcDJoaDgwNWo3M3JuMml5MDc2eDFkIn0.r1OzCvqtb8intUKrx_FozA';
    var map = L.mapbox.map('map', 'mapbox.streets')
            .setView([39.8, 116.4], 13);
    var marks=[];
    var pointGroup;
    map.on('mousemove', function (e) {
        document.getElementById("info").innerHTML =
                JSON.stringify(e.containerPoint) + '<br />' +
                JSON.stringify(e.latlng);
    });
    map.on('click', function (e) {
        console.log(e.latlng);

    });


</script>
</body>
</html>